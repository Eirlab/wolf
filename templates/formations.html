{% extends "base.html" %}

{% block content %}
<div id="content" class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <!--        <h1 class="h1 mt-3 mb-0 text-gray-800">Caméléon</h1>-->
    </div>
    <div class="card shadow mb-4">
        <a href="#select" class="d-block card-header py-3" data-toggle="collapse"
           role="button" aria-expanded="true" aria-controls="select">
            <h6 class="m-0 font-weight-bold text-secondary">Session de formation</h6>
        </a>
        <div class="collapse show card-body mb-4" id="scan">
            <!--            <div class="row">-->
            <form action="/formations/start" method="GET">
                <p class="mt-2 text-danger">Un <a
                        href="https://www.eirlab.net/wp-content/uploads/2022/06/Organigramme-2.png">fabmanager</a>
                    d'EirLab Community est nécessaire pour débuter
                    l'opération</p>

                <p class="mt-2"> Appuyez sur le bouton scanner et posez la carte d'un <a
                        href="https://www.eirlab.net/wp-content/uploads/2022/06/Organigramme-2.png">fabmanager</a>
                    d'EirLab
                    Community</p>

                <button type="submit" class="form-control btn btn-secondary">Scanner</button>
                {% if error %}
                <h4 class="font-weight-bold mt-2 text-danger">{{ error }}</h4>
                {% endif %}
            </form>
            {% if fabmanager or member %}
            <form action="/formations" method="GET">
                <button type="submit" class="form-control btn btn-danger mt-2">Quitter</button>
            </form>
            {% endif %}
            <!--            </div>-->
        </div>
    </div>
    {% if member %}
    <div class="card shadow mb-4">
        <a href="#select" class="d-block card-header py-3" data-toggle="collapse"
           role="button" aria-expanded="true" aria-controls="select">
            <h6 class="m-0 font-weight-bold text-secondary">Choix de la formation</h6>
        </a>
        <div class="collapse show card-body mb-4" id="choix">
            <h4 class="mt-2">Fabmanager : {{ member.firstname }} {{ member.lastname }} - {{ job }}</h4>
            <!--            <div class="row">-->
            <form action="/formations/confirm" method="POST">
                {% for f in member.formations %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="formations"
                           id="{{ member.formations[f].ref }}"
                           value="{{ member.formations[f].ref }}">
                    <label class="form-check-label" for="{{ member.formations[f].ref }}"> <img
                            src="{{ member.formations[f].image }}"
                            class="img-fluid rounded-circle mt-2"
                            alt="Imprimante"> </label>
                </div>

                {% endfor %}
                {% for f in member.no_formations %}
                <input class="form-check-input" type="radio" name="formations"
                       id="{{ member.no_formations[f].ref }}"
                       value="{{ member.no_formations[f].ref }}" disabled>
                <label class="form-check-label" for="{{ member.no_formations[f].ref }}"> <img
                        src="{{ member.no_formations[f].image_black }}"
                        class="img-fluid rounded-circle mt-2"
                        alt="Imprimante"> </label>
                {% endfor %}

                <button type="submit" class="form-control btn btn-secondary mt-2"
                        onclick="alert('{{ member.firstname }}, penses à cliquer sur le bouton quitter à la fin')">
                    Confirmer
                </button>
            </form>
        </div>
    </div>
    {% endif %}

    {% if formation %}
    <div class="card shadow mb-4">
        <a href="#select" class="d-block card-header py-3" data-toggle="collapse"
           role="button" aria-expanded="true" aria-controls="select">
            <h6 class="m-0 font-weight-bold text-secondary">Personnes formées</h6>
        </a>
        <div class="collapse show card-body mb-4" id="add">
            <div class="row">
                <div class="col m-2">
                    <h4 class="m-0 font-weight-bold text-secondary">Fabmanager : {{ fabmanager.firstname }} {{
                        fabmanager.lastname }} - {{ job }}</h4>
                    <h4 class="m-0 font-weight-bold text-secondary">Formation : {{ formation }}</h4>
                    <form action="/formations/add" method="GET">

                        <p class="mt-2"> Appuyez sur le bouton scanner et posez votre carte sur le lecteur</p>
                        <button type="submit" class="form-control btn btn-secondary mt-2">Scanner</button>
                    </form>

                    {% if list_add %}
                    <h5 class="mt-2">Personnes formées pendant la session</h5>
                    <ul class="list-group">
                        {% for member in list_add %}
                        <li class="list-group-item">{{ member.firstname }} {{ member.lastname }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
                <div class="col m-2">
                    {% if linked %}
                    <h4 class="font-weight-bold text-success mt-2">Adhérent lié</h4>
                    <p class="mt-2">{{ student.lastname }} {{ student.firstname }} est maintenant lié à votre carte</p>
                    {% endif %}
                    {% if not_linked %}
                    <h4 class="font-weight-bold text-danger mt-2">Erreur</h4>
                    <p class="mt-2"> Oups ! L'administrateur n'a pas été reconnu </p>
                    {% endif %}
                    {% if success %}
                    <h4 class="mt-2 font-weight-bold text-success"> Formation acquise </h4>
                    <p class="mt-2"> La formation {{ formation }} a été acquise pour {{ student.lastname }} {{
                        student.firstname }}</p>
                    {% endif %}
                    {% if error %}
                    <h4 class="mt-2 font-weight-bold text-secondary">Adhérent inconnu</h4>
                    <p class="font-italic mt-2">Remplissez les informations ci dessous</p>
                    <form action="/formations/new_link" method="POST">
                        <div class="form-group">
                            <label for="lastname">Nom</label>
                            <input type="text" class="form-control" id="lastname" name="lastname" placeholder="Nom"
                                   required>
                        </div>
                        <div class="form-group">
                            <label for="firstname">Prénom</label>
                            <input type="text" class="form-control" id="firstname" name="firstname" placeholder="Prénom"
                                   required>
                        </div>
                        <button type="submit" class="form-control btn btn-secondary">Rechercher</button>
                    </form>
                    {% endif %}

                    {% if unknow %}
                    <h4 class="font-weight-bold text-danger mt-2">Non trouvé</h4>
                    <p class="mt-2"> Oups ! {{ lastname }} {{ firstname }} n'est pas un adhérent d'EirLab
                        Community, vérifiez les informations et le cas échant rendez vous sur <a
                                href="https://www.helloasso.com/associations/eirlab-community/adhesions/adherer-a-eirlab-le-fablab-associatif-de-bordeaux-inp/">
                            adherer.eirlab.net</a> pour faire partie de l'association</p>
                    <p class="font-italic small mt-2">Si vous êtes sûr que c'est bien un adhérent d'EirLab Community,
                        n'hésitez pas à demander à un administrateur</p>
                    {% endif %}
                    {% if to_link %}
                    <h4 class="font-weight-bold text-warning mt-2">Adhérent trouvé et non lié</h4>
                    <p class="mt-2">{{ lastname }} {{ firstname }} est un adhérent d'EirLab Community </p>
                    <p class="mt-2 text-danger">Un administrateur d'EirLab Community est nécessaire pour confirmer
                        l'opération</p>

                    <p class="mt-2"> Appuyez sur le bouton confirmer et posez la carte d'un administrateur d'EirLab
                        Community</p>

                    <form action="/formations/confirm_link" method="GET">
                        <button type="submit" class="form-control btn btn-secondary">Confirmer</button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if student %}
    <div class="card shadow mb-4">
        <a href="#select" class="d-block card-header py-3" data-toggle="collapse"
           role="button" aria-expanded="true" aria-controls="select">
            <h6 class="m-0 font-weight-bold text-secondary">Fiche adhérent</h6>
            {% if student.expired %}
            <h2 class="font-weight-bold text-danger mt-2">Adhésion Expirée</h2>
            {% endif %}
        </a>
        <div class="collapse show card-body mb-4" id="fiche">
            <div class="row">
                <div class="col m-2">
                    <ul class="list-group">
                        <h3 class="font-weight-bold mt-2">{{ student.lastname }} {{ student.firstname }}</h3>
                        <p class="mt-2"><a href="mailto:{{ student.email }}"> {{ student.email }}</a></p>
                        <p class="mt-2">Validité de l'adhésion : {{ student.datec }} - {{ student.datem }}</p>
                        <p class="mt-2">{{ student.type }}</p>
                    </ul>
                </div>

                <div class="col m-2">
                    <h4 class="font-weight-bold mt-2"> Formations </h4>
                    {% for formation in student.formations %}
                    <img src="{{ student.formations[formation].image }}"
                         class="img-fluid rounded-circle mt-2"
                         alt="Imprimante">
                    {% endfor %}
                    {% for formation in student.no_formations %}
                    <img src="{{ student.no_formations[formation].image_black }}"
                         class="img-fluid rounded-circle mt-2"
                         alt="Imprimante">
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}

