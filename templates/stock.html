{% extends "base.html" %}

{% block content %}
<div class="container-fluid" id="content">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <!--        <h1 class="h1 mt-3 mb-0 text-gray-800">Caméléon</h1>-->
    </div>
    <div class="card shadow mb-4">
        <a aria-controls="select" aria-expanded="true" class="d-block card-header py-3"
           data-toggle="collapse" href="#select" role="button">
            <h6 class="m-0 font-weight-bold text-secondary">Stocks</h6>
        </a>
        <div class="collapse show card-body mb-4" id="scan">
            <div class="row">
                <div class="col m-2">
                    <h4 class="font-weight-bold text-secondary mt-2">Rechercher</h4>
                    <form action="/stock/recherche" method="POST" onsubmit="document.getElementById('container-svg-loading')
                    .style.visibility = 'visible';return true;">
                        <button class="form-control btn btn-secondary" type="submit">Débuter une recherche</button>
                        <div class="form-group">
                            <label class="mt-2" for="ref">Référence</label>
                            <input class="form-control" id="ref" name="ref" placeholder="Référence" required
                                   type="text">
                        </div>
                        <div class="form-group">
                            <label for="name">Nom</label>
                            <input class="form-control" disabled id="name" name="name" placeholder="Nom"
                                   type="text">
                        </div>
                    </form>
                    <form action="/stock/recherche" method="GET" onsubmit="document.getElementById('container-svg-scanning')
                    .style.visibility = 'visible';return true;">
                        <button class="form-control btn btn-secondary" type="submit">Scanner un code barre</button>
                    </form>
                    {% if unknow_composant %}
                    <div class="alert alert-danger" role="alert">
                        <p class="text-center">Aucun résultat trouvé</p>
                    </div>
                    {% endif %}
                </div>
                <div class="col m-2">
                    <h4 class="font-weight-bold text-secondary mt-2">Ajouter</h4>

                    <form action="/stock/arrivage" method="GET">
                        <button class="form-control btn btn-secondary" type="submit">Débuter un arrivage
                        </button>

                        <p class="mt-2 text-danger">Un <a
                                href="https://www.eirlab.net/wp-content/uploads/2022/06/Organigramme-2.png">fabmanager</a>
                            d'EirLab Community est nécessaire pour débuter
                            l'opération</p>

                        <p class="mt-2"> Appuyez sur le bouton débuter un arrivage et posez la carte d'un <a
                                href="https://www.eirlab.net/wp-content/uploads/2022/06/Organigramme-2.png">fabmanager</a>
                            d'EirLab
                            Community</p>
                    </form>
                    {% if fournisseur %}
                    <form action="/stock/arrivage/end" method="GET">
                        <button class="form-control btn btn-danger mt-2" type="submit">Quitter</button>
                    </form>
                    {% endif %}
                    {% if arrivage_error %}
                    <h4 class="font-weight-bold mt-2 text-danger">{{ arrivage_error }}</h4>
                    {% endif %}
                </div>

                <div class="col m-2">
                    <h4 class="font-weight-bold text-secondary mt-2">Inventorier</h4>

                    <form action="/stock/arrivage" method="GET">
                        <button class="form-control btn btn-secondary" disabled type="submit">Débuter un inventaire
                        </button>

                        <p class="mt-2 text-danger">Un <a
                                href="https://www.eirlab.net/wp-content/uploads/2022/06/Organigramme-2.png">fabmanager</a>
                            d'EirLab Community est nécessaire pour débuter
                            l'opération</p>

                        <p class="mt-2"> Appuyez sur le bouton débuter un inventaire et posez la carte d'un <a
                                href="https://www.eirlab.net/wp-content/uploads/2022/06/Organigramme-2.png">fabmanager</a>
                            d'EirLab
                            Community</p>
                    </form>
                </div>
            </div>
        </div>
    </div>


    {% if recherche_composant %}
    {% for composant in recherche_composant %}
    <div class="card shadow mb-4">
        <a aria-controls="select" aria-expanded="true" class="d-block card-header py-3"
           data-toggle="collapse" href="#select" role="button">
            <h6 class="m-0 font-weight-bold text-secondary">Résultats de la recherche {{
                recherche_composant[composant].fournisseur.name }}</h6>
        </a>
        <div class="col m-2">
            <div class="row">
                <div class="col m-2">
                    <h5 class="font-weight-bold text-secondary mt-2">{{ recherche_composant[composant].title }}</h5>
                    <h5 class="font-weight-bold text-secondary mt-2">{{ recherche_composant[composant].ref }}</h5>
                    <h5 class="font-weight-bold text-secondary mt-2"><a
                            href="{{ recherche_composant[composant].links_ref }}" target="_blank">Lien {{
                        recherche_composant[composant].fournisseur.name }}</a></h5>
                    <div class="text-center">
                        <img alt="Imprimante"
                             class="img-fluid mt-2"
                             src="{{ recherche_composant[composant].fournisseur.image }}" width="100px">
                    </div>
                    <p class="text-secondary font-weight-bold mt-2">{{ recherche_composant[composant].price }}</p>
                    <a class="mt-2" href="{{ recherche_composant[composant].links }}">{{
                        recherche_composant[composant].links }}</a>
                    <!--                    display recherche_composant[composant].attributes with key and value -->
                </div>
                <div class="col m-2">
                    {% if composant_eirlab %}
                    <h4 class="text-success font-weight-bold mt-2">Le composant est disponible à EirLab
                        Community</h4>
                    {% else %}
                    <h4 class="text-danger font-weight-bold mt-2">Le composant n'est pas disponible à
                        EirLab Community</h4>
                    {% endif %}
                    <div class="text-center">
                        <img alt="{{ recherche_composant[composant].title}}"
                             class="img-fluid mt-2"
                             src="{{ recherche_composant[composant].image }}" width="200px">
                    </div>
                </div>
            </div>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th scope="col">Attribut</th>
                    <th scope="col">Valeur</th>
                </tr>
                </thead>
                <tbody>
                {% for key in recherche_composant[composant].attributes %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ recherche_composant[composant].attributes[key] }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endfor %}
    {% endif %}

    {% if arrivage %}
    <div class="card shadow mb-4">
        <a aria-controls="select" aria-expanded="true" class="d-block card-header py-3"
           data-toggle="collapse" href="#select" role="button">
            <h6 class="m-0 font-weight-bold text-secondary">Choix du fournisseur</h6>
        </a>
        <div class="collapse show card-body mb-4" id="choix">
            <form action="/stock/arrivage/fournisseur" method="POST">
                {% for d in fournisseurs %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" id="{{ fournisseurs[d].name }}" name="fournisseur"
                           required
                           type="radio" value="{{ fournisseurs[d].ref  }}">
                    <label class="form-check-label" for="{{ fournisseurs[d].name }}"> <img
                            alt="{{ fournisseurs[d].ref }}"
                            class="img-fluid mt-2"
                            src="{{ fournisseurs[d].image }}"> </label>
                </div>
                {% endfor %}
                <button class="form-control btn btn-secondary mt-2" type="submit">
                    Confirmer
                </button>
            </form>
        </div>
    </div>
    {% endif %}

    {% if fournisseur %}
    <div class="card shadow mb-4">
        <a aria-controls="select" aria-expanded="true" class="d-block card-header py-3"
           data-toggle="collapse" href="#select" role="button">
            <h6 class="m-0 font-weight-bold text-secondary">Prise des références - {{ fournisseur.name }}</h6>
        </a>
        <script type="application/javascript">

        </script>
        <div class="collapse show card-body mb-4" id="prise">
            <div class="row">
                {% if arrivage_recherche %}
                <div class="col m-2">
                    <form action="/stock/arrivage/add" method="POST">
                        <div class="form-group">
                            <label class="mt-2" for="arrivage_ref">Référence</label>
                            <input autofocus class="form-control" id="arrivage_ref" name="arrivage_ref"
                                   placeholder="Référence"
                                   required type="text">
                            <label class="mt-2" for="arrivage_ref">Quantité</label>
                            <input class="form-control" id="arrivage_qte" name="arrivage_qte"
                                   placeholder="Quantité (défaut : 1, négatif pour enlever)"
                                   type="number">
                        </div>
                        <button class="form-control btn btn-secondary" type="submit">Ajouter</button>
                    </form>
                </div>
                {% endif %}
                {% if arrivage_composants %}
                <div class="col m-2">
                    <h4 class="font-weight-bold text-secondary mt-2">Liste d'ajout</h4>
                    {% for composant in arrivage_composants %}
                    <ul class="list-group">
                        <li class="list-group-item">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5 class="font-weight-bold text-secondary">{{
                                        arrivage_composants[composant].ref}} - {{
                                        arrivage_composants[composant].quantite }}</h5>
                                </div>
                                <div class="col-md-4">
                                    <form action="/stock/arrivage/remove" method="POST">
                                        <input id="{{ composant }}" name="composant" type="hidden"
                                               value="{{ composant }}">
                                        <button class="form-control btn btn-danger" type="submit">Supprimer</button>
                                    </form>
                                </div>
                            </div>
                        </li>
                    </ul>
                    {% endfor %}
                    <form action="/stock/arrivage/confirm" method="GET">
                        <button class="form-control btn btn-secondary" type="submit">Confirmer</button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if arrivage_confirm %}
    <div class="card shadow mb-4">
        <a aria-controls="select" aria-expanded="true" class="d-block card-header py-3"
           data-toggle="collapse" href="#select" role="button">
            <h6 class="m-0 font-weight-bold text-secondary">Confirmation de l'arrivage</h6>
        </a>
        <div class="collapse show card-body mb-4" id="add">
            <h4 class="font-weight-bold text-secondary mt-2">Liste d'ajout</h4>
        </div>
        <div class="collapse show card-body mb-4" id="list add">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col">Statut</th>
                    <th scope="col">Référence</th>
                    <th scope="col">Quantité</th>
                    <th scope="col">Nom</th>
                    <th scope="col">Prix</th>
                    <th scope="col">Image</th>
                    <th scope="col">Lien</th>
                    <th scope="col">Datasheet</th>
                </tr>
                </thead>
                {% for composant in products_add %}

                <tbody>
                <tr>
                    <td><i class="fas fa-check text-success"></i></td>
                    <td>Succès</td>
                    <td>{{ products_add[composant].ref }}</td>
                    <td>{{ products_add[composant].quantite }}</td>
                    <td>{{ products_add[composant].product.title }}</td>
                    <td>{{ products_add[composant].product.price }}</td>
                    <td><img alt="Imprimante"
                             class="img-fluid mt-2"
                             src="{{ products_add[composant].product.image }}" width="50px"></td>
                    <td><a href="{{ products_add[composant].product.links_ref }}">Lien fournisseur</a></td>
                    <td><a href="{{ products_add[composant].product.links }}">Datasheet</a></td>

                </tr>
                </tbody>
                {% endfor %}
                {% for composant in products_error %}
                <tbody>
                <tr>
                    <td><i class="fas fa-times text-danger"></i></td>
                    <td>{{ products_error[composant].status }}</td>
                    <td>{{ products_error[composant].ref }}</td>
                    <td>{{ products_error[composant].quantite }}</td>
                    <td>{{ products_error[composant].product.title }}</td>
                    <td>{{ products_error[composant].product.price }}</td>
                    <td><img alt="Imprimante"
                             class="img-fluid mt-2"
                             src="{{ products_error[composant].product.image }}" width="50px"></td>
                    <td><a href="{{ products_error[composant].product.links_ref }}">Lien fournisseur</a></td>
                    <td><a href="{{ products_error[composant].product.links }}">Datasheet</a></td>
                </tr>
                </tbody>
            </table>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <div class="container-animation-scanning">
        <div class="container-svg" id="container-svg-loading">
            <div class="popup-svg">
                <svg class="loading-circle" viewBox="0 0 226.12 226.12" xml:space="preserve"
                     xmlns="http://www.w3.org/2000/svg">

                    <style type="text/css">
                        .svg-loading-circle-fill {
                            fill: #39aedc;
                            transform-origin: 50% 50%;
                            animation: loading-circle 2s infinite;
                        }
                    </style>
                    <!-- <rect x=".0099945" y=".0099933" width="226.11" height="226.11"/> -->
                    <path class="svg-loading-circle-fill"
                          d="m113.06 226.12c-62.34 0-113.06-50.72-113.06-113.06s50.72-113.06 113.06-113.06c19.45 0 38.64 5.03 55.5 14.55 3.61 2.04 4.88 6.61 2.84 10.22s-6.61 4.88-10.22 2.84c-14.61-8.25-31.26-12.61-48.13-12.61-54.07 0-98.06 43.99-98.06 98.06s43.99 98.06 98.06 98.06c4.14 0 7.5 3.36 7.5 7.5s-3.34 7.5-7.49 7.5z"/>
                </svg>
            </div>
        </div>
        <div class="container-svg" id="container-svg-scanning">
            <div class="popup-svg">
                <svg class="scanner" viewBox="0 0 447.85 297.17" xml:space="preserve"
                     xmlns="http://www.w3.org/2000/svg">
                    <style type="text/css">
                        .corner {
                            fill: none;
                            stroke: #6c757d;
                            stroke-width: 6;
                            stroke-linecap: round;
                            stroke-linejoin: round;
                            stroke-miterlimit: 10;
                        }

                        .code {
                            fill: #6c757d
                        }

                        .red {
                            fill: #e2007a;
                            animation: scanner-movement 3s ease-in-out infinite alternate-reverse;
                        }
                    </style>
                    <polyline class="corner" points="115.93 219.41 63.93 219.41 63.93 271.41"
                              transform="translate(-60.93,-216.41)"/>
                    <polyline class="corner" points="453.78 219.41 505.78 219.41 505.78 271.41"
                              transform="translate(-60.93,-216.41)"/>
                    <polyline class="corner" points="115.93 510.58 63.93 510.58 63.93 458.58"
                              transform="translate(-60.93,-216.41)"/>
                    <polyline class="corner" points="453.78 510.58 505.78 510.58 505.78 458.58"
                              transform="translate(-60.93,-216.41)"/>
                    <g transform="translate(-60.93,-216.41)">
                        <rect class="code" height="226.94" width="20.93" x="103.22" y="251.76"/>
                        <rect class="code" height="226.94" width="10.46" x="139.32" y="251.76"/>
                        <rect class="code" height="226.94" width="14.4" x="162.36" y="251.76"/>
                        <rect class="code" height="226.94" width="19.39" x="190.01" y="251.76"/>
                        <rect class="code" height="226.94" width="9.7" x="220.73" y="251.76"/>
                        <rect class="code" height="226.94" width="11.71" x="238.39" y="251.76"/>
                        <rect class="code" height="226.94" width="18.24" x="263.74" y="251.76"/>
                        <rect class="code" height="226.94" width="9.12" x="297.64" y="251.76"/>
                        <rect class="code" height="226.94" width="12.37" x="323.37" y="251.76"/>
                        <rect class="code" height="226.94" width="7.76" x="347.94" y="251.76"/>
                        <rect class="code" height="226.94" width="19.62" x="367.81" y="251.76"/>
                        <rect class="code" height="226.94" width="14.87" x="402.23" y="251.76"/>
                        <rect class="code" height="226.94" width="11.41" x="428.87" y="251.76"/>
                        <rect class="code" height="226.94" width="17.75" x="453.78" y="251.76"/>
                    </g>
                    <rect class="red" height="20.26" width="433.54" x="6.77" y="138.65"/>
                </svg>
            </div>
        </div>
    </div>
    {% endblock %}
</div>
